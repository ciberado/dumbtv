import Head from "next/head";
import Row from "../components/Row";
import Banner from "../components/Banner";
import Header from "../components/Header";
import requests from "../requests";

import getBingSourceEntries from "../lib/BingSource";

export default function Home({
  bingEntries,
  trending,
  action,
  topRated,
  horror,
  comedy,
  romance,
  documentary,
}) {
  return (
    <div className="">
      <Head>
        <title>Netflix India - Watch TV Shows Online, Watch Movies Online</title>
        <link
          href="https://fonts.googleapis.com/css2?family=Inter"
          rel="stylesheet"
        />
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Header />
      <Banner entries={ bingEntries } />

      <div className="">
        <Row title="Trending" movies={trending.results} big={true} />
        <Row title="Top rated" movies={topRated.results} />
        <Row title="Action movies" movies={action.results} />
        <Row title="Documentaries" movies={documentary.results} />
        <Row title="Comedy" movies={comedy.results} />
        <Row title="Horror " movies={horror.results} />
        <Row title="Romance" movies={romance.results} />
      </div>
    </div>
  );
}

export async function getServerSideProps(context) {
  const [
    trendingRes,
    actionRes,
    netflixRes,
    topRatedRes,
    horrorRes,
    comedyRes,
    romanceRes,
    documentaryRes,
  ] = await Promise.all([
    fetch(`https://api.themoviedb.org/3${requests.fetchTrending}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchActionMovies}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchNetflixOriginals}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchTopRated}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchHorrorMovies}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchComedyMovies}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchRomanceMovies}`),
    fetch(`https://api.themoviedb.org/3${requests.fetchDocumentaries}`),
  ]);

  const tv3 = {
    id : "TV3 directe",
    backdrop_path : "https://www.hlsplayer.org/play?url=https://directes-tv-int.ccma.cat/live-origin/canal324-hls/master.m3u8",
    poster_path : "https://img.ccma.cat/multimedia/jpg/5/8/1483009076885.jpg", 
    original_name : "TV3 directe", 
    title : "TV3 directe", 
    overview : ""
  };
  

  const [
    bingEntries,
    trending,
    action,
    netflix,
    topRated,
    horror,
    comedy,
    romance,
    documentary,
  ] = await Promise.all([
    getBingSourceEntries(),
    trendingRes.json(),
    actionRes.json(),
    netflixRes.json(),
    topRatedRes.json(),
    horrorRes.json(),
    comedyRes.json(),
    romanceRes.json(),
    documentaryRes.json(),
  ]);

  return {
    props: {
      bingEntries,
      trending,
      action,
      netflix,
      topRated,
      horror,
      comedy,
      romance,
      documentary
    },
  };
}